"use strict";(self.webpackChunklinea_legal_specs=self.webpackChunklinea_legal_specs||[]).push([[5102],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>k});var o=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,o,a=function(e,n){if(null==e)return{};var t,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=o.createContext({}),c=function(e){var n=o.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=c(e.components);return o.createElement(l.Provider,{value:n},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},m=o.forwardRef((function(e,n){var t=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=c(t),m=a,k=d["".concat(l,".").concat(m)]||d[m]||p[m]||r;return t?o.createElement(k,i(i({ref:n},u),{},{components:t})):o.createElement(k,i({ref:n},u))}));function k(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=t.length,i=new Array(r);i[0]=m;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[d]="string"==typeof e?e:a,i[1]=s;for(var c=2;c<r;c++)i[c]=t[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,t)}m.displayName="MDXCreateElement"},1932:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var o=t(7462),a=(t(7294),t(3905));const r={id:"notifications",title:"Notificaciones"},i=void 0,s={unversionedId:"notifications",id:"notifications",title:"Notificaciones",description:"Socket",source:"@site/docs/notification.md",sourceDirName:".",slug:"/notifications",permalink:"/docs/notifications",draft:!1,tags:[],version:"current",frontMatter:{id:"notifications",title:"Notificaciones"},sidebar:"someSidebar",previous:{title:"Servicios",permalink:"/docs/services"},next:{title:"S3",permalink:"/docs/s3"}},l={},c=[{value:"Socket",id:"socket",level:2},{value:"Proceso de autenticaci\xf3n a trav\xe9s de sockets",id:"proceso-de-autenticaci\xf3n-a-trav\xe9s-de-sockets",level:2},{value:"Consideraciones",id:"consideraciones",level:3},{value:"Diccionario de eventos de notificaciones",id:"diccionario-de-eventos-de-notificaciones",level:2},{value:"Nuevo evento",id:"nuevo-evento",level:3}],u={toc:c},d="wrapper";function p(e){let{components:n,...t}=e;return(0,a.kt)(d,(0,o.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"socket"},"Socket"),(0,a.kt)("h2",{id:"proceso-de-autenticaci\xf3n-a-trav\xe9s-de-sockets"},"Proceso de autenticaci\xf3n a trav\xe9s de sockets"),(0,a.kt)("admonition",{type:"warning"},(0,a.kt)("p",{parentName:"admonition"},"Debido al uso del protocolo websocket, no es posible utilizar headers, por esta raz\xf3n, el token se env\xeda como una query.")),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"El dispositivo cliente env\xeda la solicitud de conexi\xf3n con el ",(0,a.kt)("inlineCode",{parentName:"li"},"JWT")," del usuario autenticado."),(0,a.kt)("li",{parentName:"ol"},"El servidor recibe la solicitud, y verifica la validez del token del usuario.")),(0,a.kt)("h3",{id:"consideraciones"},"Consideraciones"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Si el usuario es de tipo ",(0,a.kt)("inlineCode",{parentName:"li"},"centralTable")," se conecta la sala ",(0,a.kt)("inlineCode",{parentName:"li"},"centralTable"),"."),(0,a.kt)("li",{parentName:"ul"},"Si el usuario es perteneciente al local (",(0,a.kt)("inlineCode",{parentName:"li"},"restaurantOwner"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"manager"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"staff"),") se conectar\xe1 a la sala siguiendo la estructura mencionada ",(0,a.kt)("inlineCode",{parentName:"li"},"tenant_<id>"),".")),(0,a.kt)("h1",{id:"broadcast"},"Broadcast"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Ejemplo de conexi\xf3n:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'const socket = io(`<linea_legal_server_url>`, {\n  forceNew: true,\n  reconnection: true,\n  reconnectionAttempts: 2,\n  rejectUnauthorized: false,\n  transports: ["websocket"],\n  agent: false,\n  upgrade: false,\n});\n')),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Autenticaci\xf3n:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'socket.emit(\n  "get",\n  {\n    url: "/sockets",\n    params: {\n      token: "<jwt_token>",\n      restaurant: "<organization_id>",\n    },\n  },\n  (response) => {\n    console.log("GOT RESPONSE: ", response);\n    //response includes body and statusCode\n    //handle success or error\n  }\n);\n')),(0,a.kt)("p",null,"Existen ciertos eventos dentro del sistema, los cuales ocurren bajo ciertos escenarios en espec\xedfico. Cada plataforma tiene ciertos eventos que debe escuchar y emitir. Cada plataforma deber\xe1 acceder a una sala en espec\xedfico donde escuchar\xe1 ciertos eventos de inter\xe9s."),(0,a.kt)("p",null,"Las diferentes difusiones o broadcasts a considerar se enviar\xe1n al restaurante.\nEn cada uno se especifica el room en el cual se consumir\xe1 el evento as\xed como los datos a enviar."),(0,a.kt)("p",null,"Dado que la responsabilidad de unir usuarios a un room corresponde al servidor, se deben hacer las validaciones pertinentes para unir a los usuarios a los ",(0,a.kt)("inlineCode",{parentName:"p"},"rooms")," que corresponda."),(0,a.kt)("p",null,"Para establecer un websocket es necesario conectarse de la siguiente forma."),(0,a.kt)("p",null,"Por medio de lo anterior, se establece una conexi\xf3n con el servidor mediante el protocolo websocket. Una vez conectado el socket, se procede a autenticar al usuario y solicitar la entrada al room de un restaurante en especifico."),(0,a.kt)("p",null,"Para manejar de una forma m\xe1s robusta los eventos de un socket, se puede consultar la documentaci\xf3n oficial de ",(0,a.kt)("a",{parentName:"p",href:"https://socket.io/docs"},"socket.io")," o el siguiente ",(0,a.kt)("a",{parentName:"p",href:"https://www.tutorialspoint.com/socket.io/socket.io_error_handling.htm"},"tutorial"),"."),(0,a.kt)("p",null,"Para realizar una difusi\xf3n a una aplicaci\xf3n cliente (iOS o Android) se utilizar\xe1n push notifications, puedes consultar el apartado de ",(0,a.kt)("a",{href:"#notificaciones-push"},"Notificaciones Push"),"."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Sala de Usuarios")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"La sala toma el nombre de la siguiente forma ",(0,a.kt)("inlineCode",{parentName:"li"},"user_<id>"),", en este room se emitir\xe1n eventos que sucedan dentro del contexto del usuario al que pertenezcan. Por ejemplo recibir la creaci\xf3n de un evento, etc.")),(0,a.kt)("p",null,"Si el id solicitado se encuentra en el scope del usuario, se obtendr\xe1 un ",(0,a.kt)("inlineCode",{parentName:"p"},"statusCode")," de ",(0,a.kt)("inlineCode",{parentName:"p"},"200 Ok")," y el socket se suscribir\xe1 al ",(0,a.kt)("inlineCode",{parentName:"p"},"room"),", por ejemplo un usuario con el id 33 tiene como room ",(0,a.kt)("inlineCode",{parentName:"p"},"user__33"),"."),(0,a.kt)("h2",{id:"diccionario-de-eventos-de-notificaciones"},"Diccionario de eventos de notificaciones"),(0,a.kt)("p",null,"Aqu\xed se encontrar\xe1n los distintos tipos de eventos que pasan a trav\xe9s del socket y por notificaciones push seg\xfan el escenario donde sea necesario usarse."),(0,a.kt)("h3",{id:"nuevo-evento"},"Nuevo evento"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Cuerpo de la notificaci\xf3n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "event": "order_to_inprogress",\n    "orderUUID": "f9524475-de1b-4c07-85be-aa649f526269"\n  }\n}\n')),(0,a.kt)("p",null,"Nombre del evento: ",(0,a.kt)("inlineCode",{parentName:"p"},"order_to_inprogress")),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Este evento se emite hac\xeda el servidor, indicando que la orden programada paso a en progreso."),(0,a.kt)("li",{parentName:"ol"},"Se emite la notificaci\xf3n a ",(0,a.kt)("strong",{parentName:"li"},"Usuario")," para emitir una alerta.")))}p.isMDXComponent=!0}}]);